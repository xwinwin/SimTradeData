
# 核心目标  

高效协助用户开发代码，并在无需反复提示的前提下主动解决问题。关注以下核心任务：  
  
- 编写代码  
- 优化代码  
- 调试与问题解决  
  
确保所有解决方案都清晰易懂，逻辑严密。  

除了编程语言的基础知识和一些普遍常识外，你开始思考和行动的每一步必须是有有事实基础的，比如有文档，有API或者有实际的代码存在，你不可以想当然觉得应该怎样，尤其是和你当前在开发的项目相关的工作都必须去实际double check，而且每隔一段时间都要再去check一遍。
  
---  
  
## 阶段一：初始评估  

### 1. 明确需求
 
- 用户发出请求时，优先检查项目中的所有相关文档以理解整体架构与目标。  
- 利用已有上下文（文件、代码）充分理解需求，避免偏差。  
- 若无文档，主动创建一份 `requirements.md` ，包括功能说明、使用方式和核心参数。 
- 若有文档，根据新的需求更新文档 

### 2. 设计方案
- 阅读 requirements.md，明确需求。
- 如果已经有代码则阅读现有代码，画出现有构架并根据需求明确改动点。
- 如果没有代码则画出构架图，并根据需求明确改动点。
- 保存设计方案到 `design.md` 文件中。
  
### 3. 规划TODO事项
- 阅读 design.md，根据设计规划TODO待办事项
- 和用户确认TODO事项，保存到 `todo.md` 文件中。

---  
  
## 阶段二：代码实现  

### 1. 编写代码  

- 根据design.md中的设计方案  
- 选择合适语言与框架，并遵循最佳实践（如 SOLID 原则）。  
- 编写简洁、可读、带注释的代码。  
- 优化可维护性与性能。  
- 按需提供单元测试。  
- 遵循语言标准编码规范（如 Python 使用 PEP 8）。  
- 完成一项任务后更新 `todo.md` 文件。
  
### 2. 调试与问题解决  
- 遇到问题时，首先检查代码逻辑是否正确。
- 首先深度思考分析问题根源，如有必要可以使用合适的MCP工具，避免盲目猜测。
- 系统化分析问题，找出根因。  
- 明确说明问题来源及解决方式。  
- 在问题解决过程中持续与用户沟通，如需求变动能快速适应。  
- 保存问题与解决方案到 `problems.md` 文件中。


### 3. 结构和规范复查
- 每完成一个大任务后，检查是否符合设计和规范，如有偏移及时修正。
- 检查代码是否遵循最佳实践，如有偏移及时修正。
- 保存修正后的设计到 `design.md` 文件中。
- 保存修正后的构架图到 `architecture.png` 文件中。

---  

## 阶段三：完成与总结  

1. 清晰总结本轮改动、完成目标与优化内容。  
2. 标注潜在风险或需留意的边界情况。  
3. 更新项目文档以反映最新进展。  
4. 保存总结到 `summary.md` 文件中。
5. 更新最终设计和构架到 `design.md` 和 `architecture.png` 文件中。
  
---  
  
# 最佳实践  
  
### Sequential Thinking（逐步思考工具）  
  
使用 [Sequential Thinking](https://github.com/smithery-ai/reference-servers/tree/main/src/sequentialthinking) 工具，以结构化的思维方式处理复杂、开放性问题。  
  
- 将任务拆解为若干 **思维步骤（thought steps）**。  
- 每一步应包括：  
  1.**明确当前目标或假设**（如：“分析登录方案”，“优化状态管理结构”）。  
  2.**调用合适的 MCP 工具**（如 `search_docs`、`code_generator`、`error_explainer`），用于执行查文档、生成代码或解释错误等操作。Sequential Thinking 本身不产出代码，而是协调过程。  
  3.**清晰记录本步骤的结果与输出**。  
  4.**确定下一步目标或是否分支**，并继续流程。  
  
- 在面对不确定或模糊任务时：  
  - 使用“分支思考”探索多种方案。  
  - 比较不同路径的优劣，必要时回滚或修改已完成的步骤。  
  
- 每个步骤可带有如下结构化元数据：  
  -`thought`: 当前思考内容  
  -`thoughtNumber`: 当前步骤编号  
  -`totalThoughts`: 预估总步骤数  
  -`nextThoughtNeeded`, `needsMoreThoughts`: 是否需要继续思考  
  -`isRevision`, `revisesThought`: 是否为修订行为，及其修订对象  
  -`branchFromThought`, `branchId`: 分支起点编号及标识  
  
- 推荐在以下场景使用：  
  - 问题范围模糊或随需求变化  
  - 需要不断迭代、修订、探索多解  
  - 跨步骤上下文保持一致尤为重要  
  - 需要过滤不相关或干扰性信息  
  
---  
  
### Context7（最新文档集成工具）  
  
使用 [Context7](https://github.com/upstash/context7) 工具获取特定版本的最新官方文档与代码示例，用于提升生成代码的准确性与当前性。  
  
-**目的**：解决模型知识过时问题，避免生成已废弃或错误的 API 用法。  
  
-**使用方式**：  
  1.**调用方式**：在提示词中加入 `use context7` 触发文档检索。  
  2.**获取文档**：Context7 会拉取当前使用框架/库的相关文档片段。  
  3.**集成内容**：将获取的示例与说明合理集成到你的代码生成或分析中。  
  
-**按需使用**：**仅在需要时调用 Context7**，例如遇到 API 模糊、版本差异大或用户请求查阅官方用法。避免不必要的调用，以节省 token 并提高响应效率。  
  
-**集成方式**：  
  - 支持 roo Code, Claude Code、Gemini Cli 等 MCP 客户端。  
  - 通过配置服务端集成 Context7，即可在上下文中获取最新参考资料。  
  
-**优势**：  
  - 提升代码准确性，减少因知识过时造成的幻觉与报错。  
  - 避免依赖训练时已过期的框架信息。  
  - 提供明确、权威的技术参考材料。  
  

# 沟通规范  
  
- 所有内容必须使用 **中文** 交流（包括代码注释）。  
- 在10行以内的改动可以直接修改，超过10行的改动应先与用户讨论需求和方案。
- 遇到不清楚的内容应立即向用户提问。
- 编写文档时禁止夸张表述和自吹自擂，实事求是说明情况即可
- 表达清晰、简洁、技术准确。  
- 在代码中应添加必要的注释解释关键逻辑。  

# 开发和测试共同遵守

-	用中文写注释
-	程序中严禁使用 emoji，只有在文档中可以克制地使用部分表情符号
-	如果文件读写出错就用mcp filesystem
-	永远使用 poetry run python xxx.py 来运行代码，禁止直接用 python xxx.py
-	除了本身就是模拟模块和测试,任何地方都绝对不允许使用模拟对象和数据
- 及时清理不用的代码和文件

# 开发遵守

-	始终以架构文档为准绳，保持代码的模块化、可扩展性和可维护性
-	这是全新开发，不需要向后兼容，旧代码必须尽快删除，让测试尽快出错。兼容设计会把新错误掩盖，让测试失去作用
-	每次在做稍大的修改前，仔细阅读文档，认真审视我们的设计需求和计划
-	提出更改设计意见的时候要避免过度设计增加不必要的复杂性和维护困难
-	在新建代码或开发新功能之前，请先检查项目是否已有类似实现，并向我解释为何不能直接复用现有功能，同时说明是否可以删除冗余部分以保持整洁
-	若涉及大量设计上的修改，未经我同意不得擅自改动文件，必须先提交一个令人信服的修改理由以及影响范围评估

# 测试遵守

- 测试的代码必须与被测试的代码保持同步更新
- 禁止编造，导入，测试不存在的测试对象/类/函数，及其属性。导入和测试前必须确定测试对象/类/函数存在，调用的属性也存在。
- 测试的目的是找出被测试代码的问题，而不是测试本身的问题
-	不要轻易修改核心代码去配合测试，除非代码真的有错误
- 除非是核心代码有较大改动，否则不要大幅修改测试
-	当有核心代码有较大改动时，彻底重写相应测试
-	不要为了快速解决眼前问题而不顾全局，必须深度思考问题根源，用最小的改动去解决问题
- 严格限制 Mock 的使用：只有在与外部系统（如数据库、第三方 API）或不稳定的基础设施交互时，才允许使用 Mock。在模块内部或模块间的交互，应优先使用真实对象。
- 不要创建Integration和unit测试目录，用pytest自带的marker区分
- 当一次测试错误发现大于5个的时候，一个一个修复错误，不要一次修复过多
- 每一个错误修复不应该超过10行代码，超过必须请示用户